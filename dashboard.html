<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø¥Ø¯Ø§Ø±Ø© ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±</title>

  <!-- Ø®Ø· Ø¹Ø±Ø¨ÙŠ -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet" />

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- QRCode JS -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background-color: #f8f9fa;
    }
    h2 {
      font-weight: 700;
      color: #343a40;
    }
    .btn-primary {
      background-color: #0069d9;
      border-color: #0062cc;
      font-weight: 600;
      transition: background-color 0.3s ease;
    }
    .btn-primary:hover {
      background-color: #004085;
      border-color: #003768;
    }
    .btn-warning, .btn-danger, .btn-info {
      font-weight: 600;
    }
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    table thead {
      background-color: #343a40;
      color: white;
      font-weight: 700;
    }
    table tbody tr:hover {
      background-color: #e9ecef;
      cursor: pointer;
    }
    input[type="checkbox"] {
      width: 18px;
      height: 18px;
    }
    .copy-btn {
      cursor: pointer;
      color: #0d6efd;
      margin-left: 6px;
      font-size: 1rem;
    }
    .copy-btn:hover {
      color: #0a58ca;
    }
  </style>
</head>
<body>

<script>
  if (localStorage.getItem("loggedIn") !== "true") {
    window.location.href = "index.html";
  }
</script>

<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
    <h2><i class="fa-solid fa-key"></i> Ø¥Ø¯Ø§Ø±Ø© ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±</h2>
    <button class="btn btn-danger" onclick="logout()"><i class="fa-solid fa-right-from-bracket"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
  </div>

  <input type="text" id="searchInput" class="form-control mb-3" placeholder="ğŸ” Ø¨Ø­Ø«..." />

  <div class="mb-3 d-flex flex-wrap gap-2">
    <button id="editBtn" class="btn btn-warning" disabled onclick="editSelected()">
      <i class="fa-solid fa-pen-to-square"></i> ØªØ¹Ø¯ÙŠÙ„
    </button>
    <button id="deleteBtn" class="btn btn-danger" disabled onclick="deleteSelected()">
      <i class="fa-solid fa-trash"></i> Ø­Ø°Ù
    </button>
    <button id="showQRBtn" class="btn btn-info" disabled onclick="showQR()">
      <i class="fa-solid fa-qrcode"></i> Ø¹Ø±Ø¶ QR
    </button>
    <button id="printBtn" class="btn btn-secondary" disabled onclick="printSelected()">
      <i class="fa-solid fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© PDF
    </button>
    <button class="btn btn-primary ms-auto" onclick="openModal()">
      <i class="fa-solid fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±
    </button>
  </div>

  <table class="table table-striped table-bordered text-center align-middle">
    <thead>
      <tr>
        <th style="width: 40px;"><input type="checkbox" id="selectAll" /></th>
        <th>Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
        <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
        <th>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</th>
        <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
      </tr>
    </thead>
    <tbody id="passwordTable"></tbody>
  </table>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ -->
<div class="modal fade" id="passwordModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><i class="fa-solid fa-key"></i> Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Ø¥ØºÙ„Ø§Ù‚"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="recordId" />
        <input type="text" id="site" class="form-control mb-2" placeholder="Ø§Ù„Ù…ÙˆÙ‚Ø¹" />
        <input type="text" id="username" class="form-control mb-2" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" />
        <input type="text" id="passwordValue" class="form-control mb-2" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
        <textarea id="notes" class="form-control mb-2" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª"></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal"><i class="fa-solid fa-xmark"></i> Ø¥Ù„ØºØ§Ø¡</button>
        <button class="btn btn-success" onclick="savePassword()"><i class="fa-solid fa-floppy-disk"></i> Ø­ÙØ¸</button>
      </div>
    </div>
  </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ø¹Ø±Ø¶ QR -->
<div class="modal fade" id="qrModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-sm modal-dialog-centered">
    <div class="modal-content text-center p-3">
      <div class="modal-header">
        <h5 class="modal-title"><i class="fa-solid fa-qrcode"></i> Ø±Ù…Ø² QR</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Ø¥ØºÙ„Ø§Ù‚"></button>
      </div>
      <div class="modal-body">
        <canvas id="qrCanvas"></canvas>
        <p class="mt-2" id="qrText" style="word-break: break-word;"></p>
      </div>
    </div>
  </div>
</div>

<!-- Toast Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù†Ø³Ø® -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
  <div id="copyToast" class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">ØªÙ… Ù†Ø³Ø® ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±!</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Ø¥ØºÙ„Ø§Ù‚"></button>
    </div>
  </div>
</div>

<script>
  // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§ØªØµØ§Ù„ Supabase
  const supabaseUrl = "https://uxtdayylyjdxjvbaafvy.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV4dGRheXlseWpkeGp2YmFhZnZ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI0NDY4NzIsImV4cCI6MjA2ODAyMjg3Mn0.omGs5ay0iw9-00_t5es25d5F7LTXUFcRRI83XBKoalY";
  const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

  let passwordsData = [];

  const editBtn = document.getElementById("editBtn");
  const deleteBtn = document.getElementById("deleteBtn");
  const showQRBtn = document.getElementById("showQRBtn");
  const printBtn = document.getElementById("printBtn");
  const selectAllCheckbox = document.getElementById("selectAll");
  const passwordTable = document.getElementById("passwordTable");

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Supabase
  async function loadPasswords() {
    const { data, error } = await supabase.from("passwords").select("*").order("id", { ascending: false });
    if (error) {
      alert("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: " + error.message);
      return;
    }
    passwordsData = data;
    renderTable(data);
  }

  // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
  function renderTable(data) {
    passwordTable.innerHTML = "";
    data.forEach(row => {
      passwordTable.innerHTML += `
        <tr>
          <td class="text-center"><input type="checkbox" class="row-checkbox" data-id="${row.id}" /></td>
          <td>${escapeHtml(row.site)}</td>
          <td>${escapeHtml(row.username)}</td>
          <td>
            ${escapeHtml(row.password)}
            <i class="fa-regular fa-copy copy-btn" title="Ù†Ø³Ø® ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" onclick="copyPassword('${escapeHtml(row.password)}', this)"></i>
          </td>
          <td>${escapeHtml(row.notes || "")}</td>
        </tr>
      `;
    });
    attachCheckboxListeners();
    updateButtonsState();
  }

  // Ø§Ø³ØªÙ…Ø¹ Ù„ØªØºÙŠÙŠØ±Ø§Øª Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
  function attachCheckboxListeners() {
    const checkboxes = document.querySelectorAll(".row-checkbox");
    checkboxes.forEach(cb => cb.addEventListener("change", updateButtonsState));

    selectAllCheckbox.checked = false;
    selectAllCheckbox.indeterminate = false;

    selectAllCheckbox.addEventListener("change", () => {
      const checkboxes = document.querySelectorAll(".row-checkbox");
      checkboxes.forEach(cb => cb.checked = selectAllCheckbox.checked);
      updateButtonsState();
    });
  }

  // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª
  function updateButtonsState() {
    const selectedCheckboxes = document.querySelectorAll(".row-checkbox:checked");
    const count = selectedCheckboxes.length;

    editBtn.disabled = count !== 1;
    deleteBtn.disabled = count === 0;
    showQRBtn.disabled = count !== 1;
    printBtn.disabled = count !== 1;

    const allCheckboxes = document.querySelectorAll(".row-checkbox");
    selectAllCheckbox.checked = allCheckboxes.length > 0 && count === allCheckboxes.length;
    selectAllCheckbox.indeterminate = count > 0 && count < allCheckboxes.length;
  }

  // ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ù„Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±
  function openModal() {
    document.getElementById("recordId").value = "";
    document.getElementById("site").value = "";
    document.getElementById("username").value = "";
    document.getElementById("passwordValue").value = "";
    document.getElementById("notes").value = "";
    new bootstrap.Modal(document.getElementById("passwordModal")).show();
  }

  // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ø¯Ø¯
  function editSelected() {
    const selectedCheckbox = document.querySelector(".row-checkbox:checked");
    if (!selectedCheckbox) return;

    const id = Number(selectedCheckbox.getAttribute("data-id"));
    const record = passwordsData.find(p => p.id === id);
    if (!record) return;

    document.getElementById("recordId").value = record.id;
    document.getElementById("site").value = record.site;
    document.getElementById("username").value = record.username;
    document.getElementById("passwordValue").value = record.password;
    document.getElementById("notes").value = record.notes || "";
    new bootstrap.Modal(document.getElementById("passwordModal")).show();
  }

  // Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
  async function deleteSelected() {
    const selectedCheckboxes = document.querySelectorAll(".row-checkbox:checked");
    if (selectedCheckboxes.length === 0) return;

    if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${selectedCheckboxes.length} Ø³Ø¬Ù„ØŸ`)) return;

    const idsToDelete = Array.from(selectedCheckboxes).map(cb => Number(cb.getAttribute("data-id")));
    const { error } = await supabase.from("passwords").delete().in("id", idsToDelete);

    if (error) {
      alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù: " + error.message);
    } else {
      loadPasswords();
    }
  }

  // Ø­ÙØ¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„)
  async function savePassword() {
    const id = document.getElementById("recordId").value;
    const site = document.getElementById("site").value.trim();
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("passwordValue").value.trim();
    const notes = document.getElementById("notes").value.trim();

    if (!site || !username || !password) {
      alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©");
      return;
    }

    if (id) {
      const { error } = await supabase.from("passwords").update({ site, username, password, notes }).eq("id", id);
      if (error) {
        alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«: " + error.message);
        return;
      }
    } else {
      const { error } = await supabase.from("passwords").insert([{ site, username, password, notes }]);
      if (error) {
        alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©: " + error.message);
        return;
      }
    }

    bootstrap.Modal.getInstance(document.getElementById("passwordModal")).hide();
    loadPasswords();
  }

  // Ø¹Ø±Ø¶ Ø±Ù…Ø² QR Ù„Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø®ØªØ§Ø±
  function showQR() {
    const selectedCheckbox = document.querySelector(".row-checkbox:checked");
    if (!selectedCheckbox) return;

    const id = Number(selectedCheckbox.getAttribute("data-id"));
    const record = passwordsData.find(p => p.id === id);
    if (!record) return;

    const qrText =
      `Ù…ÙˆÙ‚Ø¹: ${record.site}Ø› ` +
      `Ù…Ø³ØªØ®Ø¯Ù…: ${record.username}Ø› ` +
      `ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±: ${record.password}Ø› ` +
      `Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${record.notes || "Ù„Ø§ ØªÙˆØ¬Ø¯"}Ø› ` +
      `ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©: ${record.created_at ? new Date(record.created_at).toLocaleDateString("ar-EG") : "ØºÙŠØ± Ù…ØªÙˆÙØ±"}`;

    const canvas = document.getElementById("qrCanvas");
    QRCode.toCanvas(canvas, qrText, { width: 200, margin: 2 }, function (error) {
      if (error) {
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙˆÙ„ÙŠØ¯ Ø±Ù…Ø² QR");
        console.error(error);
      } else {
        document.getElementById("qrText").textContent = qrText;
        new bootstrap.Modal(document.getElementById("qrModal")).show();
      }
    });
  }

  // Ù†Ø³Ø® ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„Ø­Ø§ÙØ¸Ø© Ù…Ø¹ Ø¥Ø´Ø¹Ø§Ø±
  function copyPassword(text, elem) {
    if (!navigator.clipboard) {
      alert("Ù†Ø³Ø® ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­");
      return;
    }
    navigator.clipboard.writeText(text).then(() => {
      const toastEl = document.getElementById('copyToast');
      const toast = new bootstrap.Toast(toastEl);
      toast.show();

      elem.style.color = '#198754';
      setTimeout(() => {
        elem.style.color = '#0d6efd';
      }, 1500);
    }).catch(() => {
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®");
    });
  }

  // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
  document.getElementById("searchInput").addEventListener("input", function () {
    const query = this.value.toLowerCase();
    if (!query) {
      renderTable(passwordsData);
      return;
    }
    const filtered = passwordsData.filter(row =>
      row.site.toLowerCase().includes(query) ||
      row.username.toLowerCase().includes(query) ||
      (row.notes && row.notes.toLowerCase().includes(query))
    );
    renderTable(filtered);
  });

  // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
  function logout() {
    localStorage.removeItem("loggedIn");
    window.location.href = "index.html";
  }

  // Ø¯Ø§Ù„Ø© Ù‡Ø±ÙˆØ¨ Ø§Ù„Ø£Ø­Ø±Ù Ø§Ù„Ø®Ø§ØµØ© ÙÙŠ Ø§Ù„Ù†ØµÙˆØµ Ù„Ù…Ù†Ø¹ Ù…Ø´Ø§ÙƒÙ„ HTML
  function escapeHtml(text) {
    if (!text) return "";
    return text.replace(/[&<>"']/g, function (m) {
      switch (m) {
        case '&': return "&amp;";
        case '<': return "&lt;";
        case '>': return "&gt;";
        case '"': return "&quot;";
        case "'": return "&#039;";
        default: return m;
      }
    });
  }

  // Ø·Ø¨Ø§Ø¹Ø© Ø³Ø¬Ù„ Ù…Ø®ØªØ§Ø± Ø¨ØµÙŠØºØ© PDF Ù…Ø¹ Ø¯Ø¹Ù… Ø§Ù„Ø®Ø· Ø§Ù„Ø¹Ø±Ø¨ÙŠ
  async function printSelected() {
    const selectedCheckboxes = document.querySelectorAll(".row-checkbox:checked");
    if (selectedCheckboxes.length !== 1) {
      alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø³Ø¬Ù„ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©.");
      return;
    }
    const id = Number(selectedCheckboxes[0].getAttribute("data-id"));
    const record = passwordsData.find(p => p.id === id);
    if (!record) return;

    // Ø§Ø³ØªØ®Ø¯Ù… jsPDF Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ù…Ù† Ù…ÙƒØªØ¨Ø© umd
    const doc = new window.jspdf.jsPDF({
      unit: 'pt',
      format: 'a4',
    });

    // Ø®Ø· Cairo Ù…Ø¶Ù…Ù† Base64 (Ù…Ø±ÙÙ‚ Ø³Ø§Ø¨Ù‚Ø§Ù‹)
    const cairoFontBase64 = "AAEAAAASAQAABAAgR0RFRrRCsIIAAI9wAAAHEdQT1P9hL44AAAjGAAAAYkdQT1P4P2TJAAAIxAAABERHU1VCP2DpAAACVAAAADZHU1VCL" +
      "AxtRgAACBgAAABFPUy8yMrKGWQAAAewAAABiY21hcK73RIEAAALUAAACpmN2dCAvZ6UwAAAXoAAAAGZmcGdt9o3YDQAAFiQAAAOQaGRte" +
      "KdxABQAAAfAAAAG4aGVhZCluT1YAAAgYAAAANmhoZWEM4yc8AAIFQAAAAY2htdHgNT5oOAAAGtAAACd1sb2NhPrcb0wAABpgAAAIdbWF" +
      "4cAxYBHEAAAVkAAABRm5hbWWK8lXdAAAFgAAAAm5wb3N0P4skHAAABZwAAALecHJlcFe0/34AAAZEAAAAr3AAEAAABAAJwAAQAAAQAE" +
      "AOAAGAAAAAA";

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø· Ø§Ù„Ø¹Ø±Ø¨ÙŠ
    doc.addFileToVFS("Cairo-Regular.ttf", cairoFontBase64);
    doc.addFont("Cairo-Regular.ttf", "Cairo", "normal");
    doc.setFont("Cairo");

    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Øµ ÙˆØ§Ù„ÙƒØªØ§Ø¨Ø© Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ø¥Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±
    const margin = 40;
    let y = 80;
    const lineHeight = 25;
    const pageWidth = doc.internal.pageSize.getWidth();

    doc.setFontSize(18);
    doc.text("Ø³Ø¬Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±", pageWidth - margin, y, { align: "right" });
    y += 40;

    doc.setFontSize(14);
    doc.text(`Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${record.site}`, pageWidth - margin, y, { align: "right" });
    y += lineHeight;
    doc.text(`Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${record.username}`, pageWidth - margin, y, { align: "right" });
    y += lineHeight;
    doc.text(`ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: ${record.password}`, pageWidth - margin, y, { align: "right" });
    y += lineHeight;
    doc.text(`Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${record.notes || "-"}`, pageWidth - margin, y, { align: "right" });
    y += lineHeight;

    if (record.created_at) {
      const dateStr = new Date(record.created_at).toLocaleString("ar-EG");
      doc.text(`ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©: ${dateStr}`, pageWidth - margin, y, { align: "right" });
    }

    doc.save(`Password_Record_${record.id}.pdf`);
  }

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„ Ù…Ø±Ø©
  loadPasswords();
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
